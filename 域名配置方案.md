# 域名配置方案 - Vercel + Supabase + Render

## 🎯 域名分配策略

### 推荐方案：主域名 + 子域名分离
```
主域名: yourdomain.com      → Vercel (前端)
API域名: api.yourdomain.com → Render (后端)
```

### 优势：
- ✅ **用户体验好**：主域名访问前端，专业感强
- ✅ **架构清晰**：前后端分离，便于维护
- ✅ **SEO友好**：主域名用于前端，有利于搜索引擎收录
- ✅ **扩展灵活**：后续可以添加admin.yourdomain.com等

## 📋 DNS配置步骤

### 第一步：Vercel配置主域名
```bash
# 1. 在Vercel控制台添加域名
# 项目设置 → Domains → Add Domain

# 2. Vercel会提供DNS记录
# 通常是：
# A记录: yourdomain.com → 76.76.19.19
# A记录: www.yourdomain.com → 76.76.19.19
```

### 第二步：Render配置API子域名
```bash
# 1. 在Render控制台添加自定义域名
# Service → Settings → Custom Domains → Add Custom Domain

# 2. Render会提供DNS记录
# 通常是：
# CNAME记录: api.yourdomain.com → your-app.onrender.com
```

### 第三步：域名解析配置
```bash
# 在你的域名服务商控制台添加：

# 主域名解析 (Vercel)
A记录: yourdomain.com → 76.76.19.19
A记录: www.yourdomain.com → 76.76.19.19

# API子域名解析 (Render)
CNAME记录: api.yourdomain.com → your-app.onrender.com

# 可选：确保www跳转到主域名
# Vercel会自动处理www重定向
```

## 🔧 前端配置修改

### 修改API基础URL
```typescript
// web_app/src/lib/api.ts
const getApiBaseUrl = () => {
  if (import.meta.env.PROD) {
    // 生产环境使用自定义域名
    return 'https://api.yourdomain.com';
  } else {
    // 开发环境使用本地
    return 'http://localhost:8000';
  }
};

export const API_BASE_URL = getApiBaseUrl();
```

### 环境变量配置
```bash
# web_app/.env.production
VITE_API_URL=https://api.yourdomain.com
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key
```

## 🔒 SSL证书配置

### 自动配置
- ✅ **Vercel**：自动为你的域名配置SSL证书
- ✅ **Render**：自动为子域名配置SSL证书
- ✅ **无需手动操作**：两个平台都支持Let's Encrypt自动续期

### 验证HTTPS
```bash
# 部署后测试：
curl -I https://yourdomain.com
curl -I https://api.yourdomain.com

# 都应该返回 200 OK 和 SSL 证书信息
```

## 🌐 访问流程

### 用户访问路径
```
1. 用户访问: https://yourdomain.com
   ↓
2. Vercel提供前端页面
   ↓
3. 前端调用: https://api.yourdomain.com/api/...
   ↓
4. Render提供API服务
   ↓
5. API连接Supabase数据库
```

### API端点示例
```bash
# 用户注册
POST https://api.yourdomain.com/api/register

# 用户登录
POST https://api.yourdomain.com/api/login

# 上传文件
POST https://api.yourdomain.com/api/watermark/embed

# 检测侵权
POST https://api.yourdomain.com/api/watermark/detect
```

## 📱 移动端适配

### 响应式设计
```typescript
// 确保前端支持移动端
// web_app/src/App.css 或使用Tailwind CSS
@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }
}
```

### PWA支持（可选）
```bash
# 添加PWA配置，让用户可以"添加到主屏幕"
npm install @vite-pwa/vite-plugin
```

## 🛠️ 部署清单

### 部署前检查
- [ ] 推送最新代码到GitHub
- [ ] 确认前端构建成功 (`npm run build`)
- [ ] 确认后端依赖正确 (`pip install -r requirements.txt`)
- [ ] 测试本地环境正常运行

### 部署步骤
1. **Vercel部署**
   ```bash
   # 连接GitHub仓库到Vercel
   # 添加域名 yourdomain.com
   # 配置环境变量
   ```

2. **Render部署**
   ```bash
   # 连接GitHub仓库到Render
   # 添加域名 api.yourdomain.com
   # 配置环境变量
   ```

3. **DNS配置**
   ```bash
   # 在域名服务商添加DNS记录
   # 等待DNS生效（通常5-10分钟）
   ```

4. **测试验证**
   ```bash
   # 测试主域名访问
   # 测试API接口调用
   # 测试用户注册登录流程
   ```

## 🔍 故障排查

### 常见问题
1. **DNS解析失败**
   - 检查DNS记录是否正确
   - 使用 `nslookup` 验证解析

2. **SSL证书错误**
   - 等待证书自动生成（最多24小时）
   - 检查域名指向是否正确

3. **API调用失败**
   - 检查CORS配置
   - 验证环境变量设置

4. **Render休眠问题**
   - 设置UptimeRobot监控
   - 每10分钟ping一次健康检查端点

### 调试工具
```bash
# DNS检查
nslookup yourdomain.com
nslookup api.yourdomain.com

# SSL检查
# 访问 https://www.ssllabs.com/ssltest/

# API测试
curl -X GET https://api.yourdomain.com/health
```

## 📈 监控和分析

### 免费监控工具
- **Google Analytics**：网站访问统计
- **UptimeRobot**：服务可用性监控
- **Vercel Analytics**：前端性能分析
- **Render Metrics**：后端性能监控

### 关键指标
- **网站可用性**：>99%
- **页面加载时间**：<3秒
- **API响应时间**：<500ms
- **错误率**：<1%

## 🎉 部署完成后的效果

### 用户体验
- 🌐 访问 `https://yourdomain.com` 直接使用产品
- 📱 支持PC和移动端
- 🔒 全站HTTPS加密
- ⚡ 全球CDN加速

### 技术架构
- 🏗️ 前后端完全分离
- 🔄 自动部署和更新
- 📊 完整的监控体系
- 🛡️ 企业级安全配置

### 后续扩展
- 📧 可以添加 `mail.yourdomain.com`
- 👥 可以添加 `admin.yourdomain.com`
- 📊 可以添加 `stats.yourdomain.com`
- 🌍 可以添加多语言支持

## 💡 小贴士

1. **保留开发环境**
   - 使用 `dev.yourdomain.com` 用于测试新功能

2. **备份策略**
   - 定期备份Supabase数据
   - 保留代码版本历史

3. **性能优化**
   - 启用Gzip压缩
   - 配置缓存策略
   - 优化图片大小

---

配置完成后，你的用户就可以通过专业域名访问产品了！需要我帮你开始配置哪一步？
